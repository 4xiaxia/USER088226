# ä¸œé‡Œæ‘æ™ºèƒ½å¯¼æ¸¸ç³»ç»Ÿ - ANP é€šä¿¡åè®®æ–‡æ¡£ä¸­å¿ƒ

æ¬¢è¿æ¥åˆ° ANP (Agent Network Protocol) ä»£ç†é€šä¿¡åè®®æ–‡æ¡£ä¸­å¿ƒï¼

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### æ ¸å¿ƒæ–‡æ¡£

| æ–‡æ¡£ | æè¿° | é€‚åˆäººç¾¤ |
|------|------|----------|
| [ANP åè®®è§„èŒƒ](./ANP_PROTOCOL.md) | å®Œæ•´çš„åè®®è®¾è®¡æ–‡æ¡£ï¼ŒåŒ…å«æ¶æ„ã€æ•°æ®ç»“æ„ã€æ¶ˆæ¯ç±»å‹ç­‰ | æ¶æ„å¸ˆã€é«˜çº§å¼€å‘è€… |
| [ä½¿ç”¨æŒ‡å—](./ANP_USAGE_GUIDE.md) | å¿«é€Ÿä¸Šæ‰‹æŒ‡å—ï¼ŒåŒ…å«ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µ | æ‰€æœ‰å¼€å‘è€… |
| [æ—¶åºå›¾é›†](./ANP_SEQUENCE_DIAGRAMS.md) | è¯¦ç»†çš„æ¶ˆæ¯æµè½¬æ—¶åºå›¾ï¼Œè¦†ç›–å„ç§åœºæ™¯ | æƒ³è¦æ·±å…¥ç†è§£çš„å¼€å‘è€… |
| [åœ°å›¾å¯¼èˆªåŠŸèƒ½æŒ‡å—](./MAP_NAVIGATION_GUIDE.md) | é«˜å¾·åœ°å›¾é›†æˆã€è·¯çº¿ç»˜åˆ¶ã€é›¶é…ç½®å¯¼èˆªè¯¦è§£ | å‰ç«¯å¼€å‘è€…ã€äº§å“ç»ç† |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 5åˆ†é’Ÿä¸Šæ‰‹

```typescript
import { AgentA } from '../services/agentSystem';

// 1. å‘é€æ–‡æœ¬æ¶ˆæ¯
const result = await AgentA.processUserRequest(
  "è®²è®²ä¸œé‡Œæ‘",
  "ä¸œé‡Œæ‘",
  "text"
);

// 2. æ˜¾ç¤ºç»“æœ
console.log(result.text);
```

å°±è¿™ä¹ˆç®€å•ï¼æ›´å¤šç”¨æ³•è¯·æŸ¥çœ‹ [ä½¿ç”¨æŒ‡å—](./ANP_USAGE_GUIDE.md)ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·äº¤äº’å±‚                   â”‚
â”‚  (BottomChatWidget, AgentPresenter) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ANP ç½‘ç»œå±‚                  â”‚
â”‚  (AgentNetwork æ¶ˆæ¯æ€»çº¿)             â”‚
â”‚  â€¢ register()    æ³¨å†Œä»£ç†            â”‚
â”‚  â€¢ dispatch()    æ¶ˆæ¯åˆ†å‘            â”‚
â”‚  â€¢ monitor()     çŠ¶æ€ç›‘æ§            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼        â–¼        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
    â”‚Agent Aâ”‚ â”‚Agent Bâ”‚ â”‚Agent Dâ”‚
    â”‚ é—¨é¢  â”‚ â”‚ å·¥å…·  â”‚ â”‚æ•°æ®æ±  â”‚
    â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
        â”‚        â”‚        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Gemini AI Service     â”‚
    â”‚  â€¢ SiliconFlow (ä¸»)     â”‚
    â”‚  â€¢ Zhipu AI (å¤‡ç”¨)      â”‚
    â”‚  â€¢ MiniMax TTS (è¯­éŸ³)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“– æ ¸å¿ƒæ¦‚å¿µ

### ANP æ¶ˆæ¯æ ¼å¼

æ‰€æœ‰é€šä¿¡éƒ½é€šè¿‡ç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼:

```typescript
interface ANPMessage {
  id: string;           // æ¶ˆæ¯ID (req_xxx / resp_xxx)
  timestamp: number;    // æ—¶é—´æˆ³
  source: AgentID;      // æ¥æº (A | B | D | USER)
  target: AgentID;      // ç›®æ ‡ (A | B | D | BROADCAST)
  type: MessageType;    // ç±»å‹ (REQUEST | RESPONSE | EVENT | ERROR)
  action: string;       // åŠ¨ä½œ (call_tool, tool_result, etc.)
  payload: any;         // è´Ÿè½½æ•°æ®
}
```

### ä»£ç†è§’è‰²

| ä»£ç† | è§’è‰² | èŒè´£ |
|------|------|------|
| **Agent A** | é—¨é¢ä»£ç† | æ„å›¾è¯†åˆ«ã€è¯·æ±‚è·¯ç”±ã€ç»“æœå°è£… |
| **Agent B** | å·¥å…·æ‰§è¡Œå™¨ | è°ƒç”¨AIæœåŠ¡ã€æ‰§è¡Œå…·ä½“ä»»åŠ¡ |
| **Agent D** | æ•°æ®æ±  | ä¸Šä¸‹æ–‡ç®¡ç†ã€çŠ¶æ€ç»´æŠ¤ |

---

## ğŸ› ï¸ å¼€å‘å·¥å…·

### ANP Monitor ç›‘æ§é¢æ¿

åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ç›‘æ§é¢æ¿:

```typescript
import ANPMonitor from '../components/ANPMonitor';

{process.env.NODE_ENV === 'development' && <ANPMonitor />}
```

åŠŸèƒ½ç‰¹æ€§:
- âœ… å®æ—¶ä»£ç†å¥åº·çŠ¶æ€
- âœ… æ¶ˆæ¯å†å²è®°å½•
- âœ… å…±äº«ä¸Šä¸‹æ–‡æŸ¥çœ‹
- âœ… ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- âœ… è°ƒè¯•æ¨¡å¼å¼€å…³

### è°ƒè¯•æ—¥å¿—

```typescript
import { Network } from '../services/agentSystem';

// å¯ç”¨è°ƒè¯•æ¨¡å¼ - æŸ¥çœ‹æ‰€æœ‰æ¶ˆæ¯æµ
Network.enableDebugMode();

// ç¦ç”¨è°ƒè¯•æ¨¡å¼
Network.disableDebugMode();
```

---

## ğŸ“Š å…¸å‹åœºæ™¯

### åœºæ™¯1: æ–‡æœ¬å¯¹è¯

```
ç”¨æˆ· â†’ AgentA â†’ Network â†’ AgentB â†’ GeminiService â†’ SiliconFlow API
                                                            â†“
ç”¨æˆ· â† AgentA â† Network â† AgentB â† GeminiService â† [AIå“åº”]
```

**è€—æ—¶**: 500-3000ms (ä¸»è¦åœ¨AI APIè°ƒç”¨)

### åœºæ™¯2: å›¾ç‰‡è¯†åˆ«

```
ç”¨æˆ·ä¸Šä¼ ç…§ç‰‡ â†’ AgentA (mode='photo') â†’ AgentB â†’ objectRecognition
                                                        â†“
                                              [AIè¯†åˆ« + ç”Ÿæˆçºªå¿µå›¾]
                                                        â†“
ç”¨æˆ·æ˜¾ç¤ºç»“æœ â† AgentA â† Network â† AgentB â† {explanation, memorial_image}
```

### åœºæ™¯3: è´­ç‰©æŸ¥è¯¢

```
ç”¨æˆ·é—®"ä¹°ç‰¹äº§" â†’ AgentA.parseIntent() â†’ {isCommerce: true}
                                              â†“
                          AgentB.get_shopping_info() â†’ AIæ¨è
                                              â†“
ç”¨æˆ·çœ‹åˆ°å•†å“å¡ç‰‡ â† {products[], businesses[]}
```

---

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°å·¥å…· (3æ­¥)

1. **å®ç°å·¥å…·å‡½æ•°** (`geminiService.ts`)
   ```typescript
   export async function myNewTool(param: string): Promise<Result> {
     // å®ç°é€»è¾‘
   }
   ```

2. **æ³¨å†Œå·¥å…·** (`agentSystem.ts`)
   ```typescript
   const tools = {
     'my_new_tool': geminiService.myNewTool,
     // ... å…¶ä»–å·¥å…·
   };
   ```

3. **æ·»åŠ æ„å›¾è¯†åˆ«** (`agentSystem.ts`)
   ```typescript
   function parseIntent(text: string) {
     if (text.includes('å…³é”®è¯')) {
       return { tool: 'my_new_tool', isCommerce: false };
     }
   }
   ```

å®Œæˆï¼æ–°å·¥å…·å·²é›†æˆåˆ° ANP ç½‘ç»œã€‚

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å…³é”®æŒ‡æ ‡

| æ“ä½œ | å¹³å‡è€—æ—¶ | ä¼˜åŒ–ç›®æ ‡ |
|------|---------|----------|
| æ„å›¾è§£æ | <1ms | å·²ä¼˜åŒ– |
| æ¶ˆæ¯è·¯ç”± | <5ms | å·²ä¼˜åŒ– |
| AI APIè°ƒç”¨ | 500-3000ms | **ç“¶é¢ˆ** |
| UIæ¸²æŸ“ | ~50ms | å·²ä¼˜åŒ– |

### ä¼˜åŒ–ç­–ç•¥

1. **è¯·æ±‚åˆå¹¶**: ç›¸ä¼¼è¯·æ±‚å…±äº«ç»“æœ
2. **ç»“æœç¼“å­˜**: å¸¸è§é—®é¢˜ç¼“å­˜
3. **æµå¼å“åº”**: SSEå®ç°å®æ—¶è¿”å›
4. **æŒ‰éœ€åŠ è½½**: éŸ³é¢‘æŒ‰éœ€ç”Ÿæˆ

è¯¦è§ [ä½¿ç”¨æŒ‡å— - æ€§èƒ½ä¼˜åŒ–](./ANP_USAGE_GUIDE.md#æ€§èƒ½ä¼˜åŒ–å»ºè®®)

---

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|----------|
| æ¶ˆæ¯æ— å“åº” | Agent Bæœªæ³¨å†Œ | æ£€æŸ¥ `Network.getAgentHealth()` |
| APIè°ƒç”¨å¤±è´¥ | API Keyæ— æ•ˆ | æ£€æŸ¥ `.env` é…ç½® |
| éŸ³é¢‘æ— æ³•æ’­æ”¾ | æµè§ˆå™¨ä¸æ”¯æŒ | ä½¿ç”¨ WebAudio APIå…¼å®¹æ–¹æ¡ˆ |
| å†…å­˜æ³„æ¼ | æ¶ˆæ¯å†å²ç´¯ç§¯ | è°ƒç”¨ `Network.clearHistory()` |

è¯¦ç»†æ’æŸ¥æ­¥éª¤è§ [ä½¿ç”¨æŒ‡å— - æ•…éšœæ’æŸ¥](./ANP_USAGE_GUIDE.md#æ•…éšœæ’æŸ¥)

---

## ğŸ¯ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **ç»Ÿä¸€å…¥å£**: å§‹ç»ˆä½¿ç”¨ `AgentA.processUserRequest()`
2. **é”™è¯¯å¤„ç†**: æ£€æŸ¥ `result.error` å’Œ `result.timeout`
3. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨é˜²æŠ–ã€ç¼“å­˜ã€æŒ‰éœ€åŠ è½½
4. **è°ƒè¯•å·¥å…·**: å¼€å‘ç¯å¢ƒä½¿ç”¨ ANPMonitor

### âŒ é¿å…åšæ³•

1. **ç»•è¿‡ANP**: ä¸è¦ç›´æ¥è°ƒç”¨ `geminiService`
2. **å¿½ç•¥é”™è¯¯**: ä¸è¦å‡è®¾è¯·æ±‚ä¸€å®šæˆåŠŸ
3. **é˜»å¡UI**: ä½¿ç”¨ Loading çŠ¶æ€
4. **å†…å­˜æ³„æ¼**: å®šæœŸæ¸…ç†å†å²è®°å½•

---

## ğŸ“ ä»£ç ç¤ºä¾‹

### å®Œæ•´èŠå¤©ç»„ä»¶

```typescript
import { AgentA } from '../services/agentSystem';
import { useState } from 'react';

const ChatWidget = ({ spotName }) => {
  const [messages, setMessages] = useState([]);
  const [loading, setLoading] = useState(false);

  const handleSend = async (text: string) => {
    setLoading(true);
    
    try {
      const result = await AgentA.processUserRequest(text, spotName, 'text');
      
      if (result.error || result.timeout) {
        setMessages(prev => [...prev, { 
          sender: 'system', 
          text: 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•' 
        }]);
      } else {
        setMessages(prev => [...prev, { 
          sender: 'ai', 
          text: result.text,
          audio: result.audio_base_64
        }]);
      }
    } catch (error) {
      console.error('Unexpected error:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      {/* æ¶ˆæ¯åˆ—è¡¨ */}
      {messages.map((msg, i) => (
        <MessageBubble key={i} message={msg} />
      ))}
      
      {/* è¾“å…¥æ¡† */}
      <input onSubmit={handleSend} disabled={loading} />
    </div>
  );
};
```

æ›´å¤šç¤ºä¾‹è§ [ä½¿ç”¨æŒ‡å—](./ANP_USAGE_GUIDE.md#ç»„ä»¶é›†æˆ)

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒå®ç°

- `services/agentSystem.ts` - ANPæ ¸å¿ƒé€»è¾‘
- `services/geminiService.ts` - AIæœåŠ¡å°è£…
- `types.ts` - ç±»å‹å®šä¹‰

### UIç»„ä»¶

- `components/BottomChatWidget.tsx` - åº•éƒ¨èŠå¤©
- `components/AgentPresenter.tsx` - å®Œæ•´äº¤äº’
- `components/ANPMonitor.tsx` - ç›‘æ§é¢æ¿
- `components/VoiceInteractionPanel.tsx` - è¯­éŸ³é¢æ¿

---

## ğŸ“ è·å–å¸®åŠ©

- ğŸ“– é˜…è¯»å®Œæ•´æ–‡æ¡£: [ANPåè®®è§„èŒƒ](./ANP_PROTOCOL.md)
- ğŸ“ å­¦ä¹ ä½¿ç”¨æ–¹æ³•: [ä½¿ç”¨æŒ‡å—](./ANP_USAGE_GUIDE.md)
- ğŸ“Š ç†è§£æ¶ˆæ¯æµç¨‹: [æ—¶åºå›¾é›†](./ANP_SEQUENCE_DIAGRAMS.md)
- ğŸ’¬ è”ç³»æŠ€æœ¯å›¢é˜Ÿ

---

## ğŸ“œ ç‰ˆæœ¬å†å²

- **v1.0.0** (å½“å‰ç‰ˆæœ¬)
  - âœ… åŸºç¡€ANPåè®®å®ç°
  - âœ… Agent A, B, D è§’è‰²åˆ’åˆ†
  - âœ… åŒAIä¾›åº”å•†å¤‡ä»½
  - âœ… è°ƒè¯•å·¥å…·å’Œç›‘æ§é¢æ¿

---

## ğŸŒŸ ç‰¹è‰²åŠŸèƒ½

1. **ğŸ”€ æ™ºèƒ½æ„å›¾è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å•†ä¸šã€çŸ¥è¯†ã€å¯¹è¯æ„å›¾
2. **ğŸ”„ æ•…éšœè‡ªåŠ¨åˆ‡æ¢**: ä¸»APIå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨
3. **ğŸ“Š å¯è§‚æµ‹æ€§**: å®Œæ•´çš„æ¶ˆæ¯è¿½è¸ªå’ŒçŠ¶æ€ç›‘æ§
4. **ğŸ›¡ï¸ å®¹é”™æœºåˆ¶**: è¶…æ—¶å¤„ç†ã€é”™è¯¯é™çº§ã€å‹å¥½æç¤º
5. **âš¡ é«˜æ€§èƒ½**: å¼‚æ­¥éé˜»å¡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å¹¶å‘å¤„ç†

---

**ANP Protocol** - Powering Intelligent Agent Communication

---

*Last Updated: 2024-12-02*
